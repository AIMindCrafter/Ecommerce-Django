{% extends 'app/base.html' %}
{% load static %}
{% block title %}Product Detail{% endblock title %}

{% block main-content %}
<div class="container my-5">
    <div class="row">
        <div class="col-sm-6 text-center align-self-center">
            <img src="{{ product.product_image.url }}" alt="" class="img-fluid img-thumbnail">
        </div>
        <div class="col-sm-5 offset-sm-1">
            <h2>{{ product.title }}</h2>
            <hr>
            <p>{{ product.description }}</p>
            <h4>Rs. {{ product.discounted_price }}</h4>
            <small class="text-decoration-line-through text-muted fs-5">
                <del>Rs. {{ product.selling_price }}</del>
            </small>
            <br><br>
            <h4>Product Features</h4>
            <ul class="fs-5">
                <li>{{ product.description }}</li>
            </ul>
            <div class="buttons row">
                <form action="{% url 'add-to-cart' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <div class="quantity-controls mb-3">
                        <label for="quantity" class="form-label">Quantity:</label>
                        <div class="input-group" style="width: 150px;">
                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity(-1)">-</button>
                            <input type="number" class="form-control text-center" id="quantity" name="quantity" value="1" min="1" max="10">
                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity(1)">+</button>
                        </div>
                    </div>
                    <div class="d-flex">
                        <button type="submit" class="btn btn-primary px-4 me-2">Add to Cart</button>
                        <button type="submit" name="buy_now" value="true" class="btn btn-warning px-4">Buy Now</button>
                    </div>
                </form>
            </div>
            
            {% if messages %}
            <div class="messages mt-3">
                {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="mt-4">
                <h4>Total Price: <span id="total-price">Rs. {{ product.discounted_price }}</span></h4>
            </div>
        </div>
    </div>
</div>

<script>
    function updateQuantity(change) {
        const quantityInput = document.getElementById('quantity');
        const currentQuantity = parseInt(quantityInput.value);
        const newQuantity = Math.max(1, Math.min(10, currentQuantity + change));
        quantityInput.value = newQuantity;
        
        // Update total price
        const pricePerUnit = {{ product.discounted_price }};
        const totalPrice = pricePerUnit * newQuantity;
        document.getElementById('total-price').textContent = 'Rs. ' + totalPrice.toFixed(2);
    }

    // Add event listener for manual input
    document.getElementById('quantity').addEventListener('change', function() {
        const value = parseInt(this.value);
        if (value < 1) this.value = 1;
        if (value > 10) this.value = 10;
        updateQuantity(0); // Update total price
    });
</script>
{% endblock main-content %}